---
import { meta } from '../../utils/const';

import Skills from './Skills.astro';
import Companies from './Companies.astro';
import Projects from './Projects.astro';
import Education from './Education.astro';
import Certificate from './Certificate.astro';

// Props for sections
let { sections } = Astro.props;
---

<!-- Glass Navigation Pills Container -->
<div class="container relative z-20">
	<div class="glass-panel p-2 mb-8 animate-fade-in max-w-4xl mx-auto backdrop-blur-xl">
		<div class="flex flex-wrap justify-center gap-2">
			{
				sections.map((section: any, index: any) => (
					<button
						class={`${section.key}-toggle toggle px-6 py-3 rounded-xl font-medium text-slate-400 transition-all duration-300 flex items-center gap-2 hover:text-white hover:bg-white/5 relative overflow-hidden group ${index === 0 ? 'active text-white bg-white/10 shadow-lg shadow-blue-500/10' : ''}`}
						data-key={section.key}
						data-id={section.id}
					>
						<i class={`fa-solid ${section.icon} text-sm transition-transform duration-300 group-hover:scale-110`} />
						<span>{section.title}</span>
                        
                        <!-- Active Indicator -->
                        <div class="absolute bottom-0 left-0 w-full h-0.5 bg-gradient-to-r from-blue-500 to-purple-500 transform scale-x-0 transition-transform duration-300 group-hover:scale-x-100 origin-left"></div>
					</button>
				))
			}
		</div>
	</div>
</div>

<!-- Content Sections -->
<div class="container relative z-10 min-h-[500px]">
	{
		sections.map((section: any, index: any) => {
			return (
				<div
					id={section.key}
					class={`${index !== 0 ? 'hidden' : ''} toggle-elems animate-slide-up transition-all duration-500`}
					data-key={section.key}
					data-id={section.id}
				>
					{section.component === 'Skills' && <Skills />}
					{section.component === 'Companies' && <Companies />}
					{section.component === 'RecentProjects' && <Companies type="projects" title={meta.topProjects.title} description={meta.topProjects.description} />}
					{section.component === 'Projects' && <Projects />}
					{section.component === 'Education' && <Education />}
					{section.component === 'Certificate' && <Certificate />}
				</div>
			);
		})
	}
</div>

<script is:inline>
	document.addEventListener('DOMContentLoaded', function() {
		document.querySelectorAll('.toggle').forEach((toggle) => {
			toggle.addEventListener('click', function (e) {
				e.preventDefault();
				e.stopPropagation();
				
				const key = this.getAttribute('data-key');
				const id = this.getAttribute('data-id');
				const elem = document.getElementById(key);
				
				if (!elem) {
					console.error('Element not found:', key);
					return;
				}
				
				const sections = document.querySelectorAll('.toggle-elems');
				const toggles = document.querySelectorAll('.toggle');
				
				// Remove active class from all buttons in the same group
				toggles.forEach((tgl) => {
					let dataID = tgl.getAttribute('data-id');
					if (id === dataID) {
						tgl.classList.remove('active', 'text-white', 'bg-white/10', 'shadow-lg', 'shadow-blue-500/10');
                        tgl.classList.add('text-slate-400');
					}
				});

				// Add active class and styling to clicked button
				toggle.classList.add('active', 'text-white', 'bg-white/10', 'shadow-lg', 'shadow-blue-500/10');
                toggle.classList.remove('text-slate-400');
				
				// Hide all sections in the same group with smooth transition
				sections.forEach((section) => {
					const dataID = section.getAttribute('data-id');
					if (id == dataID && !section.classList.contains('hidden')) {
						section.style.opacity = '0';
						section.style.transform = 'translateY(20px)';
						setTimeout(() => {
							section.classList.add('hidden');
						}, 300);
					}
				});
				
				// Show selected section with smooth transition
				setTimeout(() => {
					if (elem.classList.contains('hidden')) {
						elem.classList.remove('hidden');
						elem.style.opacity = '0';
						elem.style.transform = 'translateY(20px)';
						
						// Force reflow
						elem.offsetHeight;
						
						setTimeout(() => {
							elem.style.opacity = '1';
							elem.style.transform = 'translateY(0)';
						}, 50);
					}
				}, 250);
			});
		});
	});
</script>
