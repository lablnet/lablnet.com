---
import { getCollection } from 'astro:content';
import { compareByDate, df } from '../../utils';

let projects = await getCollection('projects', (p) => p.data.featured);
projects = projects.sort(compareByDate);
---

<section class="mt-12 py-10 px-5 container">
	<h2 class="text-emphasis font-recoleta text-2xl dark:text-gray-300">Things I've been working on.</h2>
	<p class="dark:text-gray-300 prose mt-4">
		I've been working on a lot of things over the years. Here are some of the things I've been working on recently.
	</p>
	<div class="mt-8 space-y-12">
		{
			projects.map(async (project: any) => {
				const { Content } = await project.render();

				console.log('comp', project.data.company);
				let company: any = project.data.company
					? await getCollection('companies', (p) => p.slug === project.data.company)
					: undefined;
				// check if its array.
				if (company && company.length > 0) {
					company = company[0];
				}
				console.log('company', company, 'title', company.data);
				return (
					<div class="flex">
						<div class="text-muted font-medium text-sm w-20 pt-0.5 shrink-0 dark:text-gray-300">
							{project.data.endDate ? df.format(project.data.endDate) : 'Ongoing'}
						</div>
						<div class="ml-0.5">
							<h3 class="text-emphasis font-medium dark:text-gray-300">
								<span>{project.data.title}</span>
								{company ? (
									<>
										{' '}
										<a class="dark:text-gray-300 arrow" href={`/${company.slug}`}>
											@{' '}{company.data.title}
										</a>
									</>
								) : (
									''
								)}
							</h3>
							<div class="prose mt-2 dark:text-gray-300">
								<Content />
							</div>
						</div>
					</div>
				);
			})
		}
	</div>
</section>
